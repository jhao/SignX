# SignX 工具模块体验重设计（先设计后开发）

## 1. 背景与目标
当前各业务模块已经具备基础 CRUD，但在“可用性”和“可操作流程”上不足，重点问题包括：

1. 多个字段本质是枚举值，仍采用自由输入，导致数据不可控。
2. 新增后缺乏“可编辑”闭环，运营人员很难持续维护。
3. 工具配置完成后，缺乏“可复用职责 Prompt”，二次调度 AI 时上下文不一致。
4. 工具维护模块没有清晰上手引导，用户不知道从哪里开始。

本次改造目标：

- 给关键字段增加下拉选择，降低输入错误。
- 提供“新增 + 编辑”的完整维护体验。
- 支持从工具信息自动生成 AI Prompt，并可手动调整。
- 在工具模块建立“引导流程 + 常用工具样例（10种）”。

---

## 2. 互联网调研与约束说明

### 2.1 计划调研主题
- AI Agent Tool Calling / Function Calling 的配置规范。
- MCP 风格工具接入的职责边界设计。
- 企业内部工具目录（Tool Catalog）最佳实践。

### 2.2 本环境联网现状
本次在容器内尝试联网检索时，外部 HTTPS 请求被代理层拒绝（`CONNECT tunnel failed, response 403`），无法直接抓取公开网页内容。

- 尝试方式：`python urllib` 请求 DuckDuckGo 搜索页。
- 尝试方式：`curl -I` 请求公开文档链接。
- 结果：均被 403 拒绝。

因此本设计采用“行业通用实践 + 现有系统上下文”完成，并在实现中预留可替换字段（如接入模式、认证方式、职责边界、Prompt 模板），便于后续联网补充后快速迭代。

---

## 3. 设计方案（信息架构）

### 3.1 企业模块（示例）
- `business_model` 改为下拉：SaaS / 咨询服务 / 电商 / 制造 / 其他。
- `accounting_method` 改为下拉：权责发生制 / 收付实现制 / 混合制。

### 3.2 工具模块主流程（核心）
将“工具维护”拆成 3 步，引导用户顺序完成：

1. **选样例或手动填写**：先选 10 种常用工具样例可快速起步。
2. **定义职责边界**：填写分类、接入方式、认证方式、职责范围。
3. **生成 Prompt 并保存**：自动生成可复用 AI Prompt，提交后可再次编辑。

### 3.3 工具数据结构建议
- `name`：工具名称
- `description`：用途描述
- `supported_by_mcp`：是否 MCP 接入
- `config`（JSON 中扩展）
  - `category`
  - `integration_mode`
  - `auth_type`
  - `responsibility_scope`
  - `ai_prompt`
  - 其他连接参数（`base_url` 等）

说明：为减少数据库迁移成本，本次将新增元信息先放入 `config JSON`。

### 3.4 可编辑闭环
- 工具清单中每一项增加“编辑”按钮。
- 点击后将当前配置回填到表单。
- 提交时根据是否有 `editing_tool_id` 自动判断走创建或更新接口。

### 3.5 Prompt 生成规则（可复用）
生成模板包含以下要素：
- 角色定位（你是谁）
- 分类/接入/认证约束
- 职责边界
- 执行规范（先校验再调用）
- 安全与审计要求

---

## 4. 最常用 10 种工具样例（用于引导）

1. 网页搜索（SERP）
2. 网页抓取（Crawler）
3. 企业知识库检索
4. SQL 报表工具
5. 表格同步工具
6. 邮件发送
7. IM 机器人（飞书/钉钉/Slack）
8. OCR 文档解析
9. 日程排班
10. 流程引擎（审批/工单）

每个样例包含：分类、接入模式、认证方式、职责边界、默认 JSON 配置。

---

## 5. 开发落地清单

1. 后端新增 `PUT /api/v1/tools/<id>` 更新接口。
2. 工具列表返回 `updated_at` 便于前端展示维护信息。
3. 前端工具页新增三步引导 UI。
4. 前端新增 10 样例下拉并自动填表。
5. 前端新增 Prompt 生成按钮。
6. 前端工具列表增加“编辑”并回填。
7. 关键输入项改下拉（企业模块示例）。

